/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[19],{330:function(Da,ta,aa){aa.r(ta);var oa=aa(2),ja=aa(13),la=aa(1);Da=aa(40);var da=aa(32),y=aa(9);aa=function(){function x(){this.init()}x.prototype.init=function(){this.fT=!1;this.Oe=this.hi=this.connection=null;this.kn={};this.Ba=this.lx=null};x.prototype.I4=function(w){for(var f=this,a=0;a<w.length;++a){var e=w[a];switch(e.at){case "create":this.kn[e.author]||(this.kn[e.author]=e.aName);this.aY(e);break;case "modify":this.Ba.Yn(e.xfdf).then(function(b){f.Ba.qL(b[0])});
break;case "delete":this.Ba.Yn("<delete><id>"+e.aId+"</id></delete>")}}};x.prototype.aY=function(w){var f=this;this.Ba.Yn(w.xfdf).then(function(a){a=a[0];a.authorId=w.author;f.Ba.qL(a);f.Ba.trigger(ja.a.UPDATE_ANNOTATION_PERMISSION,[a])})};x.prototype.EX=function(w,f,a){this.hi&&this.hi(w,f,a)};x.prototype.preloadAnnotations=function(w){this.addEventListener("webViewerServerAnnotationsEnabled",this.EX.bind(this,w,"add",{imported:!1}),{once:!0})};x.prototype.initiateCollaboration=function(w,f,a){var e=
this;if(w){e.Oe=f;e.Ba=a.Da();a.addEventListener(ja.c.DOCUMENT_UNLOADED,function(){e.disableCollaboration()});e.e5(w);var b=new XMLHttpRequest;b.addEventListener("load",function(){if(200===b.status&&0<b.responseText.length)try{var n=JSON.parse(b.responseText);e.connection=exports.ab.H5(Object(da.g)(e.Oe,"blackbox/"),"annot");e.lx=n.id;e.kn[n.id]=n.user_name;e.Ba.mM(n.id);e.connection.gD(function(ba){ba.t&&ba.t.startsWith("a_")&&ba.data&&e.I4(ba.data)},function(){e.connection.send({t:"a_retrieve",
dId:w});e.trigger(x.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[e.kn[n.id],e.lx])},function(){e.disableCollaboration()})}catch(ba){Object(la.f)(ba.message)}});b.open("GET",Object(da.g)(this.Oe,"demo/SessionInfo.jsp"));b.withCredentials=!0;b.send();e.fT=!0;e.Ba.t2(function(n){return e.kn[n.Author]||n.Author})}else Object(la.f)("Document ID required for collaboration")};x.prototype.disableCollaboration=function(){this.hi&&(this.Ba.removeEventListener(y.a.Events.ANNOTATION_CHANGED,this.hi),this.hi=
null);this.connection&&this.connection.Oz();this.Ba&&this.Ba.mM("Guest");this.init();this.trigger(x.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};x.prototype.e5=function(w){var f=this;this.hi&&this.Ba.removeEventListener(y.a.Events.ANNOTATION_CHANGED,this.hi);this.hi=function(a,e,b){return Object(oa.b)(this,void 0,void 0,function(){var n,ba,r,h,z,ca,ha,ea,ia;return Object(oa.d)(this,function(fa){switch(fa.label){case 0:if(b.imported)return[2];n={t:"a_"+e,dId:w,annots:[]};return[4,f.Ba.kV()];case 1:ba=
fa.ma();"delete"!==e&&(r=(new DOMParser).parseFromString(ba,"text/xml"),h=new XMLSerializer);for(z=0;z<a.length;z++)ca=a[z],ea=ha=void 0,"add"===e?(ha=r.querySelector('[name="'+ca.Id+'"]'),ea=h.serializeToString(ha),ia=null,ca.InReplyTo&&(ia=f.Ba.VH(ca.InReplyTo).authorId||"default"),n.annots.push({at:"create",aId:ca.Id,author:f.lx,aName:f.kn[f.lx],parent:ia,xfdf:"<add>"+ea+"</add>"})):"modify"===e?(ha=r.querySelector('[name="'+ca.Id+'"]'),ea=h.serializeToString(ha),n.annots.push({at:"modify",aId:ca.Id,
xfdf:"<modify>"+ea+"</modify>"})):"delete"===e&&n.annots.push({at:"delete",aId:ca.Id});0<n.annots.length&&f.connection.send(n);return[2]}})})}.bind(f);this.Ba.addEventListener(y.a.Events.ANNOTATION_CHANGED,this.hi)};x.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return x}();Object(Da.a)(aa);ta["default"]=aa}}]);}).call(this || window)
